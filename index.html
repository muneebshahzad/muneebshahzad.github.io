<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories</title>
</head>
<body>
    <h1>Categories</h1>
    <p>Loading categories...</p>

    <script>
        // Function to extract the authentication code from the URL query parameters
        function getAuthCodeFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('code');
        }

        // Function to fetch categories using the authentication code
        function fetchCategories(authCode) {
            const proxyUrl = 'https://cors-anywhere.herokuapp.com/'; // CORS proxy URL
            const apiUrl = 'https://api.daraz.pk/category/tree/get';
            const appKey = '501554';
            const appSecret = 'nrP3XFN7ChZL53cXyVED1yj4iGZZtlcD';

            // Create a request payload with the authentication code
            const payload = {
                code: authCode,
                appKey: appKey,
                appSecret: appSecret
            };

            // Make a POST request to fetch categories through the CORS proxy
            fetch(proxyUrl + apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                // Display categories on the webpage
                displayCategories(data.data);
            })
            .catch(error => console.error('Error fetching categories:', error));
        }

        // Function to display categories on the webpage
        function displayCategories(categories) {
            const categoryList = document.createElement('ul');

            categories.forEach(category => {
                const categoryItem = document.createElement('li');
                categoryItem.textContent = category.name;
                categoryList.appendChild(categoryItem);

                // Check if category has children and recursively display them
                if (category.children && category.children.length > 0) {
                    const childrenList = document.createElement('ul');
                    category.children.forEach(child => {
                        const childItem = document.createElement('li');
                        childItem.textContent = child.name;
                        childrenList.appendChild(childItem);
                    });
                    categoryItem.appendChild(childrenList);
                }
            });

            // Replace loading message with category list
            const loadingMessage = document.querySelector('p');
            loadingMessage.replaceWith(categoryList);
        }

        // Main function to fetch categories when the page loads
        window.onload = function() {
            const authCode = getAuthCodeFromURL();
            if (authCode) {
                fetchCategories(authCode);
            } else {
                console.error('Authentication code not found in URL.');
            }
        };
    </script>
</body>
</html>
